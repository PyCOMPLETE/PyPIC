#pragma OPENCL EXTENSION cl_khr_int64_base_atomics : enable
inline void atomicAdd(volatile __global double *addr, double val)
{
	union {
		unsigned long u64;
		double f64;
	} next, expected, current;
	current.f64 = *addr;
	do {
		expected.f64 = current.f64;
		next.f64 = expected.f64 + val;
		current.u64 = atomic_cmpxchg(
			(volatile __global unsigned long *)addr,
		         expected.u64, next.u64);
	} while( current.u64 != expected.u64 );
}
